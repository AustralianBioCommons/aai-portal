<nav class="flex flex-1 flex-col bg-white shadow">
  <div class="flex items-center justify-between gap-6 bg-white p-6 lg:px-12">
    <button type="button" class="text-sky-500 hover:cursor-pointer">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        fill="none"
        viewBox="0 0 24 24"
        stroke-width="1.5"
        stroke="currentColor"
        class="size-8 transition-all hover:text-biocommons-primary"
      >
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"
        />
      </svg>
    </button>
    <a
      routerLink="/"
      class="cursor-pointer text-center text-2xl font-semibold text-gray-900 transition-all hover:text-gray-950 sm:text-3xl"
    >
      {{ navTitle() }}
    </a>
    @if (isGeneralAdmin()) {
      <app-dropdown-menu
        [isOpen]="userMenuOpen()"
        (isOpenChange)="userMenuOpen.set($event)"
      >
        <ng-template #trigger>
          <button
            type="button"
            (click)="userMenuOpen.set(!userMenuOpen())"
            class="focus:outline-hidden relative flex h-10 w-10 items-center justify-center rounded-full bg-gray-200 text-sm hover:cursor-pointer focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-sky-200"
            id="user-menu-button"
            aria-expanded="false"
            aria-haspopup="true"
          >
            <span class="absolute -inset-1.5"></span>
            <span class="sr-only">Open user menu</span>
            @if (user()?.picture) {
              <img
                class="h-10 w-10 rounded-full"
                [src]="user()!.picture"
                alt="User"
              />
            }
          </button>
        </ng-template>
        <ng-template #menu>
          <button
            type="button"
            class="flex w-full items-center justify-start gap-2 px-4 py-2 text-sm text-gray-700 transition-all hover:bg-gray-100 hover:text-gray-900"
            role="menuitem"
            tabindex="-1"
            routerLink="/profile"
            (click)="userMenuOpen.set(false)"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
              class="size-5"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"
              />
            </svg>
            My Profile
          </button>
          <button
            type="button"
            class="flex w-full items-center justify-start gap-2 px-4 py-2 text-sm text-gray-700 transition-all hover:bg-gray-100 hover:text-gray-900"
            role="menuitem"
            tabindex="-1"
            (click)="logout()"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 20 20"
              fill="currentColor"
              class="size-5"
            >
              <path
                fill-rule="evenodd"
                d="M3 4.25A2.25 2.25 0 0 1 5.25 2h5.5A2.25 2.25 0 0 1 13 4.25v2a.75.75 0 0 1-1.5 0v-2a.75.75 0 0 0-.75-.75h-5.5a.75.75 0 0 0-.75.75v11.5c0 .414.336.75.75.75h5.5a.75.75 0 0 0 .75-.75v-2a.75.75 0 0 1 1.5 0v2A2.25 2.25 0 0 1 10.75 18h-5.5A2.25 2.25 0 0 1 3 15.75V4.25Z"
                clip-rule="evenodd"
              />
              <path
                fill-rule="evenodd"
                d="M6 10a.75.75 0 0 1 .75-.75h9.546l-1.048-.943a.75.75 0 1 1 1.004-1.114l2.5 2.25a.75.75 0 0 1 0 1.114l-2.5 2.25a.75.75 0 1 1-1.004-1.114l1.048-.943H6.75A.75.75 0 0 1 6 10Z"
                clip-rule="evenodd"
              />
            </svg>
            Log out
          </button>
        </ng-template>
      </app-dropdown-menu>
    } @else {
      <button
        type="button"
        class="flex items-center gap-2 text-sm font-medium text-biocommons-primary transition-all hover:text-sky-900 hover:underline"
        role="menuitem"
        tabindex="-1"
        id="user-menu-item-2"
        (click)="logout()"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 20 20"
          fill="currentColor"
          class="size-5"
        >
          <path
            fill-rule="evenodd"
            d="M3 4.25A2.25 2.25 0 0 1 5.25 2h5.5A2.25 2.25 0 0 1 13 4.25v2a.75.75 0 0 1-1.5 0v-2a.75.75 0 0 0-.75-.75h-5.5a.75.75 0 0 0-.75.75v11.5c0 .414.336.75.75.75h5.5a.75.75 0 0 0 .75-.75v-2a.75.75 0 0 1 1.5 0v2A2.25 2.25 0 0 1 10.75 18h-5.5A2.25 2.25 0 0 1 3 15.75V4.25Z"
            clip-rule="evenodd"
          />
          <path
            fill-rule="evenodd"
            d="M6 10a.75.75 0 0 1 .75-.75h9.546l-1.048-.943a.75.75 0 1 1 1.004-1.114l2.5 2.25a.75.75 0 0 1 0 1.114l-2.5 2.25a.75.75 0 1 1-1.004-1.114l1.048-.943H6.75A.75.75 0 0 1 6 10Z"
            clip-rule="evenodd"
          />
        </svg>
        Log out
      </button>
    }
  </div>

  @if (isNavigationPage() && isGeneralAdmin()) {
    <!-- Mobile Dropdown (visible on small screens) -->
    <div class="mx-6 mb-8 sm:hidden">
      <select
        [value]="getCurrentRoute()"
        (change)="onNavigationChange($event)"
        class="h-12 w-full rounded-md border-r-8 border-transparent bg-biocommons-primary px-4 py-3 text-center font-light text-white shadow outline-gray-200 focus-within:ring-2 focus-within:ring-sky-100 hover:cursor-pointer"
      >
        @for (page of navigationPages; track page.route) {
          <option [value]="page.route">
            {{ page.label }}
            @if (page.label === "Pending" && userCounts().pending > 0) {
              ({{ userCounts().pending }})
            }
            @if (page.label === "Revoked" && userCounts().revoked > 0) {
              ({{ userCounts().revoked }})
            }
            @if (page.label === "Unverified" && userCounts().unverified > 0) {
              ({{ userCounts().unverified }})
            }
          </option>
        }
      </select>
    </div>

    <!-- Desktop Navigation (visible on larger screens) -->
    <div
      class="mx-auto mb-8 hidden flex-1 items-center justify-center gap-6 overflow-hidden bg-white sm:flex"
    >
      @for (page of navigationPages; track page.route) {
        <a
          [routerLink]="page.route"
          routerLinkActive
          #routerLinkActive="routerLinkActive"
          class="flex min-w-32 items-center justify-center gap-2 rounded-md py-2.5 text-sm font-medium transition-all"
          [class]="
            routerLinkActive.isActive
              ? 'bg-biocommons-primary text-white hover:bg-sky-900'
              : 'bg-sky-50 text-biocommons-primary hover:bg-sky-100'
          "
        >
          {{ page.label }}
          @if (
            isGeneralAdmin() &&
            page.label === "Pending" &&
            userCounts().pending > 0
          ) {
            <span
              class="min-h-5 min-w-5 rounded-full bg-red-500 px-1 py-0.5 text-center text-xs font-medium text-white"
            >
              {{ userCounts().pending }}
            </span>
          }
          @if (
            isGeneralAdmin() &&
            page.label === "Revoked" &&
            userCounts().revoked > 0
          ) {
            <span
              class="min-h-5 min-w-5 rounded-full bg-red-500 px-1 py-0.5 text-center text-xs font-medium text-white"
            >
              {{ userCounts().revoked }}
            </span>
          }
          @if (
            isGeneralAdmin() &&
            page.label === "Unverified" &&
            userCounts().unverified > 0
          ) {
            <span
              class="min-h-5 min-w-5 rounded-full bg-red-500 px-1 py-0.5 text-center text-xs font-medium text-white"
            >
              {{ userCounts().unverified }}
            </span>
          }
        </a>
      }
    </div>
  }
</nav>
